asyncapi: 3.0.0
info:
  title: FFC Payment Document Generator
  version: 1.0.5
  description: Generate PDF payment documents
channels:
  ffc-doc-statements/ffc-doc-statement-generator:
    address: ffc-doc-statements/ffc-doc-statement-generator
    messages:
      subscribe.message.0:
        $ref: "#/components/messages/DelinkedStatement"
      subscribe.message.1:
        $ref: "#/components/messages/Sfi23QuarterlyStatement"
  ffc-doc-statement-publish:
    address: ffc-doc-statement-publish
    messages:
      publish.message.0:
        $ref: "#/components/messages/DelinkedStatement"
      publish.message.1:
        $ref: "#/components/messages/Sfi23QuarterlyStatement"
  ffc-doc-statement-crm:
    address: ffc-doc-statement-crm
    messages:
      publish.message.0:
        $ref: "#/components/messages/Crm"
operations:
  ffc-doc-statements/ffc-doc-statement-generator.subscribe:
    action: send
    channel:
      $ref: "#/channels/ffc-doc-statements~1ffc-doc-statement-generator"
    messages:
      - $ref: "#/channels/ffc-doc-statements~1ffc-doc-statement-generator/messages/subscribe.message.0"
      - $ref: "#/channels/ffc-doc-statements~1ffc-doc-statement-generator/messages/subscribe.message.1"
  ffc-doc-statement-publish.publish:
    action: receive
    channel:
      $ref: "#/channels/ffc-doc-statement-publish"
    messages:
      - $ref: "#/channels/ffc-doc-statement-publish/messages/publish.message.0"
      - $ref: "#/channels/ffc-doc-statement-publish/messages/publish.message.1"
  ffc-doc-statement-crm.publish:
    action: receive
    channel:
      $ref: "#/channels/ffc-doc-statement-crm"
    messages:
      - $ref: "#/channels/ffc-doc-statement-crm/messages/publish.message.0"
components:
  messages:
    DelinkedStatement:
      title: Delinked Statement
      name: Delinked Statement
      contentType: application/json
      payload:
        $ref: "#/components/schemas/DelinkedStatement"
    Sfi23QuarterlyStatement:
      title: Sfi23 Quarterly Statement
      name: Sfi23 Quarterly Statement
      contentType: application/json
      payload:
        $ref: "#/components/schemas/SFI23QuarterlyPaymentStatement"
    Crm:
      title: Crm Message
      name: Crm Message
      contentType: application/json
      payload:
        $ref: "#/components/schemas/CrmMessage"
  schemas:
    ActionGroup:
      type: object
      properties:
        groupName:
          $ref: "#/components/schemas/GroupName"
        actions:
          type: array
          items:
            $ref: "#/components/schemas/Action"
    Action:
      type: object
      properties:
        actionReference:
          $ref: "#/components/schemas/ActionId"
        calculationReference:
          $ref: "#/components/schemas/CalculationId"
        actionCode:
          $ref: "#/components/schemas/ActionCode"
        actionName:
          $ref: "#/components/schemas/ActionName"
        annualValue:
          $ref: "#/components/schemas/AnnualValue"
        fundingCode:
          $ref: "#/components/schemas/FundingCode"
        groupName:
          $ref: "#/components/schemas/GroupName"
        landArea:
          $ref: "#/components/schemas/AreaClaimed"
        overDeclarationPenalty:
          $ref: "#/components/schemas/OverDeclarationPenalty"
        quarterlyPaymentAmount:
          $ref: "#/components/schemas/QuarterlyPaymentAmount"
        quarterlyValue:
          $ref: "#/components/schemas/QuarterlyValue"
        rate:
          $ref: "#/components/schemas/Rate"
        uom:
          $ref: "#/components/schemas/UnitOfMeasure"
    ActionCode:
      type: string
      description: Identifier for action code within scheme
      example: 80001
    ActionId:
      type: number
      description: Unique identifier (pkId) for action
      example: 1234567
    ActionName:
      type: string
      description: Name of the action
      example: Manage hedgerows
    Address:
      additionalProperties: false
      required:
        - line3
        - line5
        - postcode
      type: object
      properties:
        line1:
          $ref: "#/components/schemas/Street"
        line2:
          $ref: "#/components/schemas/Area"
        line3:
          $ref: "#/components/schemas/Town"
        line4:
          $ref: "#/components/schemas/Region"
        line5:
          $ref: "#/components/schemas/County"
        postcode:
          $ref: "#/components/schemas/Postcode"
    AgreementNumber:
      type: number
      description: Unique identifier for agreement
      example: 123456789
    AgreementEnd:
      type: string
      format: date-time
      description: The date the Agreement End
      example: "2022-08-22T16:45:20.891Z"
    AgreementStart:
      type: string
      format: date-time
      description: The date the Agreement Start
      example: "2022-08-22T16:45:20.891Z"
    AnnualValue:
      type: string
      description: The annual value of the action
      example: £1200 + £22.5/ha
    Area:
      type: string
      description: The second line of the address
      example: Some Area
    AreaClaimed:
      type: number
      format: decimal
      description: The area claimed for the calculation in hectares
      example: 84.05
    BusinessName:
      type: string
      description: The business name
      example: Summer Days Farm
    CalculationDate:
      type: string
      format: date-time
      description: The date the calculation was performed
      example: "2022-08-22T16:45:20.891Z"
    CalculationId:
      type: number
      description: Key field for calculation Data
      example: 1234567
    ApplicationId:
      type: number
      description: ApplicationId for calculation Data
      example: 1234567
    ClaimId:
      type: number
      description: Unique Identifier for claim
      example: 12345687
    County:
      type: string
      description: The fifth line of the address
      example: Some County
    CrmBody:
      type: object
      additionalProperties: false
      properties:
        sbi:
          $ref: "#/components/schemas/SBI"
        frn:
          $ref: "#/components/schemas/FRN"
        apiLink:
          type: string
          format: uri
          example: https://myStatementRetrievalApi/statement-receiver/statement/v1/FFC_PaymentStatement_SFI_2022_1234567890_2022090615023001.pdf
        scheme:
          type: string
          maxLength: 50
          example: Delinked
        documentType:
          type: string
          maxLength: 50
          example: Payment statement
      required:
        - sbi
        - frn
        - apiLink
        - scheme
        - documentType
    CrmMessage:
      description: Wrapper for CRM publish message
      type: object
      additionalProperties: false
      properties:
        body:
          $ref: "#/components/schemas/CrmBody"
        type:
          type: string
          example: uk.gov.doc.statement.crm
        source:
          type: string
          example: ffc-doc-statement-generator
      required:
        - body
        - type
        - source
    DelinkedScheme:
      type: object
      additionalProperties: false
      required:
        - name
        - shortName
        - year
      properties:
        name:
          type: string
          description: The name of the delinked scheme
          example: "Delinked Payment Statement"
        shortName:
          type: string
          description: The short name of the delinked scheme
          example: "DP"
        year:
          type: number
          description: The marketing year for the delinked scheme
          example: 2025
          enum: [2024, 2025]
    DelinkedStatement:
      type: object
      additionalProperties: false
      properties:
        businessName:
          $ref: "#/components/schemas/BusinessName"
        email:
          $ref: "#/components/schemas/Email"
        address:
          $ref: "#/components/schemas/Address"
        calculationId:
          $ref: "#/components/schemas/CalculationId"
        applicationId:
          $ref: "#/components/schemas/ApplicationId"
        frn:
          $ref: "#/components/schemas/FRN"
        sbi:
          $ref: "#/components/schemas/SBI"
        paymentBand1:
          $ref: "#/components/schemas/PaymentBand1"
        paymentBand2:
          $ref: "#/components/schemas/PaymentBand2"
        paymentBand3:
          $ref: "#/components/schemas/PaymentBand3"
        paymentBand4:
          $ref: "#/components/schemas/PaymentBand4"
        percentageReduction1:
          $ref: "#/components/schemas/PercentageReduction1"
        percentageReduction2:
          $ref: "#/components/schemas/PercentageReduction2"
        percentageReduction3:
          $ref: "#/components/schemas/PercentageReduction3"
        percentageReduction4:
          $ref: "#/components/schemas/PercentageReduction4"
        progressiveReductions1:
          $ref: "#/components/schemas/ProgressiveReductions1"
        progressiveReductions2:
          $ref: "#/components/schemas/ProgressiveReductions2"
        progressiveReductions3:
          $ref: "#/components/schemas/ProgressiveReductions3"
        progressiveReductions4:
          $ref: "#/components/schemas/ProgressiveReductions4"
        referenceAmount:
          $ref: "#/components/schemas/ReferenceAmount"
        totalProgressiveReduction:
          $ref: "#/components/schemas/TotalProgressiveReduction"
        totalDelinkedPayment:
          $ref: "#/components/schemas/TotalDelinkedPayment"
        paymentAmount:
          type: string
          description: The calculated payment amount
          example: "5000.00"
          pattern: '^\d+\.\d{2}$'
        paymentAmountCalculated:
          $ref: "#/components/schemas/PaymentAmountCalculated"
        transactionDate:
          $ref: "#/components/schemas/TransactionDate"
        paymentReference:
          $ref: "#/components/schemas/PaymentReference"
        paymentPeriod:
          type: string
          description: The period covered by the payment
          example: "1st Day of some date"
          maxLength: 200
        scheme:
          $ref: "#/components/schemas/DelinkedScheme"
        previousPaymentCount:
          $ref: "#/components/schemas/PreviousPaymentCount"
        documentReference:
          $ref: "#/components/schemas/DocumentReference"
        excludedFromNotify:
          type: boolean
          description: Indicates if the statement is excluded from notify
          example: false
    DocumentReference:
      type: number
      description: Unique identifier of the document
      minimum: 1
      example: 1
    Email:
      type: string
      description: The business email address
      example: farm@farms.com
    EmailAddress:
      type: string
      description: Primary email address of an organisation
      example: farm@farms.com
    FilenameDelinkedStatement:
      type: string
      description: PDF filename, formatted as product code using 3 to 6 uppercase letters, then the document type, then the scheme short name, then the year, then the FRN, then the timestamp using 16 digits and then .pdf. All separated by underscore
      example: FFC_PaymentDelinkedStatement_DP_2024_1100016529_2024102408191499.pdf
      pattern: ^[A-Z]{3,6}\_[A-Z]([A-Z0-9]*[a-z][a-z0-9]*[A-Z]|[a-z0-9]*[A-Z][A-Z0-9]*[a-z])[A-Za-z0-9]*\_[A-Z]{3,6}_\d{4}_\d{10}_\d{16}\.pdf$
    FRN:
      type: number
      description: Firm Reference Number
      minimum: 1000000000
      maximum: 9999999999
      example: 1234567890
    Funding:
      additionalProperties: false
      type: object
      required:
        - name
        - level
        - area
        - rate
        - annualValue
        - quarterlyValue
        - quarterlyReduction
        - quarterlyPayment
      properties:
        name:
          $ref: "#/components/schemas/FundingName"
        level:
          $ref: "#/components/schemas/FundingLevel"
        area:
          $ref: "#/components/schemas/FundingArea"
        rate:
          $ref: "#/components/schemas/FundingRate"
        annualValue:
          $ref: "#/components/schemas/FundingAnnualValue"
        quarterlyValue:
          $ref: "#/components/schemas/FundingQuarterlyValue"
        quarterlyReduction:
          $ref: "#/components/schemas/FundingQuarterlyReduction"
        quarterlyPayment:
          $ref: "#/components/schemas/FundingQuarterlyPayment"
    FundingCode:
      type: string
      description: Identifier for funding code within scheme
      example: 80001
    FundingName:
      type: string
      description: The funding option name
      example: Arable and horticultural soils
    FundingLevel:
      type: string
      description: The funding option level
      example: Introductory
    FundingArea:
      type: string
      description: The funding option area in hectares
      example: "45.4545"
    FundingRate:
      type: string
      description: The funding option rate in pounds per hectare
      example: "22.00"
    FundingAnnualValue:
      type: string
      description: The funding option annual value in pounds
      example: "1000.00"
    FundingQuarterlyValue:
      type: string
      description: The funding option quarterly value in pounds
      example: "250.00"
    FundingQuarterlyReduction:
      type: string
      description: The funding option quarterly reduction in pounds
      example: "0.00"
    FundingQuarterlyPayment:
      type: string
      description: The funding option quarterly payment in pounds
      example: "250.00"
    FundingTotal:
      additionalProperties: false
      type: object
      required:
        - name
        - level
        - area
        - rate
        - annualValue
        - quarterlyValue
        - quarterlyReduction
        - quarterlyPayment
      properties:
        name:
          $ref: "#/components/schemas/FundingTotalName"
        level:
          $ref: "#/components/schemas/FundingTotalLevel"
        area:
          $ref: "#/components/schemas/FundingTotalArea"
        rate:
          $ref: "#/components/schemas/FundingTotalRate"
        annualValue:
          $ref: "#/components/schemas/FundingTotalAnnualValue"
        quarterlyValue:
          $ref: "#/components/schemas/FundingTotalQuarterlyValue"
        quarterlyReduction:
          $ref: "#/components/schemas/FundingTotalQuarterlyReduction"
        quarterlyPayment:
          $ref: "#/components/schemas/FundingTotalQuarterlyPayment"
    FundingTotalName:
      type: string
      description: The funding total name
      example: Total
    FundingTotalLevel:
      type: string
      description: The funding total level
      example: ""
    FundingTotalArea:
      type: string
      description: The funding total area in hectares
      example: ""
    FundingTotalRate:
      type: string
      description: The funding total rate in pounds per hectare
      example: ""
    FundingTotalAnnualValue:
      type: string
      description: The funding total annual value in pounds
      example: ""
    FundingTotalQuarterlyValue:
      type: string
      description: The funding total quarterly value in pounds
      example: ""
    FundingTotalQuarterlyReduction:
      type: string
      description: The funding total quarterly reduction in pounds
      example: ""
    FundingTotalQuarterlyPayment:
      type: string
      description: The funding total quarterly payment in pounds
      example: ""
    GroupName:
      type: string
      description: The group name of the action
      example: Actions for hedgerows
    InvoiceNumber:
      type: string
      description: Invoice number of payment request
      example: S000000200000002V001
    OverDeclarationPenalty:
      type: string
      format: decimal
      description: The over declaration penalty
      example: 120.5
    PaymentAmount:
      type: number
      format: decimal
      description: The payment amount
      example: 800.05
    PaymentAmountCalculated:
      type: string
      description: TotalDelinkedPayment /2 should match paymentAmount
      example: "25125.00"
      pattern: '^\d+\.\d{2}$'
    PaymentBand1:
      type: string
      description: first payment band bracket amount
      example: "30000"
      pattern: '^\d+(\.\d{2})?$'
    PaymentBand2:
      type: string
      description: second payment band bracket amount
      example: "50000"
      pattern: '^\d+(\.\d{2})?$'
    PaymentBand3:
      type: string
      description: third payment band bracket amount
      example: "150000"
      pattern: '^\d+(\.\d{2})?$'
    PaymentBand4:
      type: string
      description: fourth payment band bracket amount
      example: "99999999.99"
      pattern: '^\d+(\.\d{2})?$'
    PaymentPeriod:
      type: string
      description: The period covered by the payment
      example: 1 April 2022 to 30 June 2022
    PaymentReference:
      type: string
      description: Unique identifier for payment as shown on the remittance advice
      example: PY1234545
    PercentageReduction1:
      type: string
      description: First percentage bracket for progressive reductions
      example: "50.00"
      pattern: '^\d{1,3}\.\d{2}$'
    PercentageReduction2:
      type: string
      description: Second percentage bracket for progressive reductions
      example: "55.00"
      pattern: '^\d{1,3}\.\d{2}$'
    PercentageReduction3:
      type: string
      description: Third percentage bracket for progressive reductions
      example: "60.00"
      pattern: '^\d{1,3}\.\d{2}$'
    PercentageReduction4:
      type: string
      description: Fourth percentage bracket for progressive reductions
      example: "70.00"
      pattern: '^\d{1,3}\.\d{2}$'
    Postcode:
      type: string
      description: The postcode
      example: FA1 2PY
    PreviousPaymentCount:
      type: number
      description: No of previous payment(s) that have been made on a calculation
      minimum: 0
      example: 0
    ProgressiveReductions1:
      type: string
      description: Value against band1 for progressive reductions
      example: "11000.00"
      pattern: '^\d+\.\d{2}$'
    ProgressiveReductions2:
      type: string
      description: Value against band2 for progressive reductions
      example: "22000.00"
      pattern: '^\d+\.\d{2}$'
    ProgressiveReductions3:
      type: string
      description: Value against band3 for progressive reductions
      example: "33000.00"
      pattern: '^\d+\.\d{2}$'
    ProgressiveReductions4:
      type: string
      description: Value against band4 for progressive reductions
      example: "44000.00"
      pattern: '^\d+\.\d{2}$'
    QuarterlyPaymentAmount:
      type: string
      format: decimal
      description: The quarterly payment amount
      example: 100.5
    QuarterlyValue:
      type: string
      description: The quarterly value
      example: £100.50
    Rate:
      type: string
      description: Payment in pounds sterling per hectare
      example: £22.5/ha
    Reduction:
      type: object
      required:
        - reason
        - value
      properties:
        reason:
          type: string
          description: The reason for the reduction
          example: Over declaration
        value:
          type: string
          description: The value of the reduction
          example: "100.00"
    Reference:
      type: string
      description: Settlement reference of payment request
      example: "10027651"
    ReferenceAmount:
      type: string
      description: Current reference amount of total
      example: "125000.00"
      pattern: '^\d+\.\d{2}$'
    Region:
      type: string
      description: The fourth line of the address
      example: Some Region
    SBI:
      type: number
      description: Single Business Identifier
      minimum: 105000000
      maximum: 999999999
      example: 123456789
    Scheme:
      additionalProperties: false
      type: object
      required:
        - name
        - shortName
        - year
        - frequency
        - agreementNumber
      properties:
        name:
          $ref: "#/components/schemas/SchemeName"
        shortName:
          $ref: "#/components/schemas/SchemeShortName"
        year:
          $ref: "#/components/schemas/SchemeYear"
        frequency:
          $ref: "#/components/schemas/SchemeFrequency"
        agreementNumber:
          $ref: "#/components/schemas/SchemeAgreementNumber"
    SchemeAgreementNumber:
      type: string
      description: The agreement number
      example: SFI1234567
    SchemeCode:
      type: string
      description: Unique funding option code
      example: 80001
      enum:
        - 80001
    SchemeDelinked:
      additionalProperties: false
      type: object
      required:
        - name
        - shortName
        - year
      properties:
        name:
          $ref: "#/components/schemas/SchemeName"
        shortName:
          $ref: "#/components/schemas/SchemeShortName"
        year:
          $ref: "#/components/schemas/SchemeYear"
    SchemeFrequency:
      type: string
      description: The frequency of payments
      example: Quarterly
    SchemeName:
      type: string
      description: The name of the scheme
      example: Sustainable Farming Incentive
    SchemeShortName:
      type: string
      description: The short name of the scheme
      example: SFI
    SchemeYear:
      type: string
      description: The marketing year
      example: "2022"
    SFI23QuarterlyPaymentStatement:
      type: object
      additionalProperties: false
      properties:
        businessName:
          $ref: "#/components/schemas/BusinessName"
        sbi:
          $ref: "#/components/schemas/SBI"
        frn:
          $ref: "#/components/schemas/FRN"
        email:
          $ref: "#/components/schemas/EmailAddress"
        address:
          $ref: "#/components/schemas/Address"
        scheme:
          $ref: "#/components/schemas/Scheme"
        calculationReference:
          $ref: "#/components/schemas/CalculationId"
        agreementNumber:
          $ref: "#/components/schemas/AgreementNumber"
        agreementEnd:
          $ref: "#/components/schemas/AgreementEnd"
        agreementStart:
          $ref: "#/components/schemas/AgreementStart"
        claimReference:
          $ref: "#/components/schemas/ClaimId"
        calculationDate:
          $ref: "#/components/schemas/CalculationDate"
        invoiceNumber:
          $ref: "#/components/schemas/InvoiceNumber"
        schemeCode:
          $ref: "#/components/schemas/SchemeCode"
        totalActionPayments:
          $ref: "#/components/schemas/TotalActionPayments"
        totalAdditionalPayments:
          $ref: "#/components/schemas/TotalAdditionalPayments"
        totalPayments:
          $ref: "#/components/schemas/TotalPayments"
        paymentReference:
          $ref: "#/components/schemas/PaymentReference"
        calculationId:
          $ref: "#/components/schemas/CalculationId"
        paymentPeriod:
          $ref: "#/components/schemas/PaymentPeriod"
        paymentAmount:
          $ref: "#/components/schemas/PaymentAmount"
        transactionDate:
          $ref: "#/components/schemas/TransactionDate"
        actionGroups:
          type: array
          items:
            $ref: "#/components/schemas/ActionGroup"
        previousPaymentCount:
          $ref: "#/components/schemas/PreviousPaymentCount"
        documentReference:
          $ref: "#/components/schemas/DocumentReference"
    Source:
      type: string
      description: The source of the message being sent
      example: ffc-doc-statement-generator
    Street:
      type: string
      description: The first line of the address
      example: 1 Some Street
    TotalActionPayments:
      type: string
      format: decimal
      description: Sum of all Action Payment
      example: 100.5
    TotalAdditionalPayments:
      type: string
      format: decimal
      description: Sum of all Additional Payment
      example: 50.2
    TotalDelinkedPayment:
      type: string
      description: Total annual delinked payment amount
      example: "50250.00"
      pattern: '^\d+\.\d{2}$'
    TotalPayments:
      type: string
      format: decimal
      description: Sum of all Payment
      example: 150.7
    TotalProgressiveReduction:
      type: string
      description: Total progressive reduction amount
      example: "74750.00"
      pattern: '^\d+\.\d{2}$'
    Town:
      type: string
      description: The third line of the address
      example: Some Town
    TransactionDate:
      type: string
      format: date-time
      description: The date the transaction was made
      example: "2022-08-22T16:45:20.891Z"
    UnitOfMeasure:
      type: string
      description: The unit of measure
      example: Ha